<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathMaster Workbook</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .card {
            margin-bottom: 1.5rem;
        }

        .timer {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .correct {
            background-color: #d4edda !important;
        }

        .incorrect {
            background-color: #f8d7da !important;
        }

        .hidden {
            display: none;
        }

        /* Nav button states */
        .nav-btn {
            width: 48px;
            height: 48px;
            font-weight: bold;
            font-size: 1.2rem;
            transition: background 0.2s;
            border: 2px solid #bdbdbd;
            /* Default border */
            background-color: #e0e0e0;
            /* Default bg */
            color: #333;
            /* Default text */
        }

        .nav-btn.active {
            border-color: #212529 !important;
        }

        .nav-btn.marked {
            background-color: #ffe066 !important;
            color: #333 !important;
            border-color: #ffd700 !important;
        }

        .nav-btn.answered {
            background-color: #1976d2;
            color: #fff;
            border-color: #1976d2;
        }
    </style>
</head>

<body class="bg-light">
    <div class="container py-4 d-flex flex-column align-items-center justify-content-center" style="min-height: 100vh;">
        <h1 class="mb-2 text-center">MathMaster Workbook</h1>
        <div class="mb-4 d-flex justify-content-center align-items-center" id="quiz-status-header">
            <span class="badge bg-secondary me-2">Unattempted: <span id="unattempted-count"></span></span>
            <span class="badge bg-success me-2">Answered: <span id="answered-count"></span></span>
            <span class="badge bg-warning text-dark me-2">To Review: <span id="toreview-count"></span></span>
            <span class="badge bg-primary">Total: <span id="total-count"></span></span>
        </div>
        <div id="quiz-area" class="w-100" style="max-width: 900px;">
            <form id="quiz-form">
                <div id="question-list">
                    {% for q in questions %}
                    <div class="card question-card mx-auto" data-qid="{{q.id}}"
                        style="min-height: 350px; font-size: 1.25rem; {% if not loop.first %}display:none;{% endif %}">
                        <div class="card-body d-flex flex-row">
                            <div class="flex-grow-1 pe-4 border-end">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="badge bg-primary">Question {{loop.index}} of
                                        {{questions|length}}</span>
                                    <span class="timer" id="timer-{{q.id}}">Time: 0s</span>
                                </div>
                                <h5 class="card-title" style="font-size:1.5rem;">{{q.question_text}}</h5>
                                <div class="mb-3 mt-4">
                                    {% if q.type == 'single' %}
                                    <input type="number" step="any" class="form-control answer-input"
                                        name="answer-{{q.id}}" autocomplete="off"
                                        style="font-size:1.25rem; height:3rem;">
                                    {% elif q.type == 'dual' %}
                                    <div class="row g-2">
                                        <div class="col">
                                            <input type="number" class="form-control answer-input"
                                                name="answer-{{q.id}}-quotient" placeholder="Quotient"
                                                autocomplete="off" style="font-size:1.25rem; height:3rem;">
                                        </div>
                                        <div class="col">
                                            <input type="number" class="form-control answer-input"
                                                name="answer-{{q.id}}-remainder" placeholder="Remainder"
                                                autocomplete="off" style="font-size:1.25rem; height:3rem;">
                                        </div>
                                    </div>
                                    {% elif q.type == 'text' %}
                                    <input type="text" class="form-control answer-input" name="answer-{{q.id}}"
                                        autocomplete="off" style="font-size:1.25rem; height:3rem;">
                                    {% endif %}
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-4">
                                    <button type="button" class="btn btn-secondary prev-btn">Previous</button>
                                    <button type="button" class="btn btn-warning mark-btn">Mark for Review</button>
                                    <button type="button" class="btn btn-success next-btn">Next</button>
                                    <button type="button" class="btn btn-primary submit-btn">Submit</button>
                                </div>
                            </div>
                            <div class="d-flex flex-column align-items-center justify-content-center ps-4"
                                style="min-width: 140px;">
                                <div class="d-grid gap-2" style="grid-template-columns: repeat(2, 1fr);" role="group"
                                    aria-label="Question Navigation">
                                    {% for n in range(questions|length) %}
                                    <button type="button" class="nav-btn mb-0 rounded-circle"
                                        data-nav="{{n}}">{{n+1}}</button>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </form>
        </div>
        <div id="result-area" class="hidden w-100" style="max-width: 900px;">
            <div class="card">
                <div class="card-body">
                    <h2 class="text-center">Quiz Complete!</h2>
                    <div id="score-summary" class="mb-4 text-center"></div>
                    <div class="table-responsive">
                        <table class="table table-bordered align-middle text-center">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Question</th>
                                    <th>Your Answer</th>
                                    <th>Result</th>
                                    <th>Correct Answer</th>
                                    <th>Time (s)</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body"></tbody>
                        </table>
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary" onclick="window.location.reload()">Try Again</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = {{ questions| tojson }};
    </script>
    <script src="/static/app.js"></script>
</body>

</html>